function getPixelRatio(e){var n=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/n}function resizeLetterSize(){var e=document.documentElement.clientWidth,n=document.documentElement.clientHeight,t=n/e;e>n&&(t=e/n);var i=e*(t=t>1.608?t:1.608)*.75;$("html, body").width(e),$("html, body").height(e*t),$(".content-wrap").css("min-height",.86*i+"px")}function getInfoResolve(e){var n=e.name,t=e.joinDate,i=new Date,c=Date.parse(t),o=Math.round((i-c)/1e3/86400);$(".staff-name").html(n),$(".day").html(o),$(".loader-wrap").hide(),$(".scene").css({top:0,left:0,opacity:1});$(".staff-section").fadeIn(1e3,function(){$(".time-section").fadeIn(1e3,function(){dynamicAppendText("光阴荏苒 白驹过隙<br>与你朝夕相处的日子<br>有酸甜苦辣 有欢笑和泪花<br>一起见证你的青春年少 风华正茂<br>一起经历你的彷徨与迷茫 坚强与执着 <br>一起见证你的成长 与团队共进步 <br>让我们继续同心 同行 风雨彩虹<br>因为有你<br>21CN的明天更精彩",$(".msg")[0],function(){setTimeout(function(){$(".share-section").fadeIn(1e3)},500)})})})}function setPageShare(e){var n=e.url,t=e.title,i=e.desc,c=e.picUrl;$.ajax({url:"http://event.21cn.com/api/v1/wxin/getSign2.do",data:{url:encodeURIComponent(window.location.href.split("#")[0])},type:"post",dataType:"jsonp",jsonp:"jsoncallback",timeout:3e3,success:function(e){var o=e.signature,a=e.nonceStr,s=e.timeStr;wx.config({debug:!1,appId:"wxe632d63bbcfe4e6c",timestamp:s,nonceStr:a,signature:o,jsApiList:["onMenuShareAppMessage","onMenuShareTimeline","onMenuShareWeibo","onMenuShareQQ","onMenuShareQZone"]}),wx.ready(function(){document.getElementById("audio").play(),wx.onMenuShareTimeline({title:t,desc:i,link:n,imgUrl:c,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:t,desc:i,link:n,imgUrl:c,success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:t,desc:i,link:n,imgUrl:c,success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:t,desc:i,link:n,imgUrl:c,success:function(){},cancel:function(){}}),wx.onMenuShareQZone({title:t,desc:i,link:n,imgUrl:c,success:function(){},cancel:function(){}})})},error:function(e,n){}})}function getUserInfo(e){var n=localStorage.getItem("accessToken"),t={};n&&""!=n&&(t=Object.assign(t,{"X-Access-Token":n})),$.ajax({url:"../api/getUserInfo?t="+Date.parse(new Date),method:"GET",headers:t,success:function(n){0==n.result&&n.name?e(n):401==n.result&&n.redirectUrl?window.location.replace(n.redirectUrl):404==n.result?(console.log(n.msg),$(".loader-wrap").hide(),$(".scene").css({top:0,left:0,opacity:1}),$(".scene1").hide(),$(".scene2").show()):alert("网络错误，请检查网络")}})}function dynamicAppendText(e,n,t){var i=e.length,c=(e.split(""),["#d00","#00d","#0d0","#cc0","#c0c","#0cc","#000"]),o=0,a=setInterval(function(){if(o<=i){var s=e.charAt(o-1);if(["<",">","/","&","e","m","s","p",";"].indexOf(s)<0){n.innerHTML=e.substring(0,o)+'<span id="cursor">'+(1&o?"_":"")+"</span>";var r=Math.floor(Math.random()*c.length);document.getElementById("cursor").style.color=c[r]+""}o++}else n.innerHTML+="<br />",n.removeChild(document.getElementById("cursor")),window.clearInterval(a),t&&t()},80)}$(function(){resizeLetterSize(),window.onresize=resizeLetterSize,window.onorientationchange=resizeLetterSize,getUserInfo(getInfoResolve),setPageShare({url:"http://k.21cn.com/18th/events/",title:"Beyond | 21CN十八周年庆",desc:"与你分享21CN十八岁生日的喜悦",picUrl:"http://k.21cn.com/18th/events/images/wx-share.png"}),setShareInfo({url:"http://k.21cn.com/18th/events/",title:"Beyond | 21CN十八周年庆",summary:"与你分享21CN十八岁生日的喜悦",pic:"http://k.21cn.com/18th/events/images/wx-share.png"}),$(".share-btn").click(function(){$(".ercode-section").fadeIn(300),$(".share-btn").hide();var e=$("#canvas")[0],n=e.getContext("2d"),t=getPixelRatio(n);e.width=window.innerWidth*t,e.height=window.innerHeight*t,n.scale(t,t),setTimeout(function(){html2canvas(document.querySelector(".scene1"),{canvas:e,onrendered:function(e){}}).then(function(e){$(".music-switch").hide(),$(".for-screen").attr("src",e.toDataURL("image/png")),$(".for-screen").css("display","block"),$(".share-mask").show()})},1200)}),$(".music-switch").click(function(e){var n=$(this),t=$("audio")[0];n.hasClass("music-play")?t.pause():t.play(),n.toggleClass("music-play")})});