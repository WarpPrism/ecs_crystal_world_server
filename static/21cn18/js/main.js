function initPage(){$(".container").css("height",document.documentElement.clientWidth*sl+"px");var t=document.getElementById("container");clientWidth=t.clientWidth,clientHeight=t.clientHeight,baseFontSize=+document.getElementsByTagName("html")[0].style.fontSize.slice(0,-2);var i=$(".main-container");i.css("width",clientWidth+"px"),i.css("height",clientHeight+"px"),$("#background-canvas").attr("width",clientWidth+"px"),$("#background-canvas").attr("height",clientHeight+"px"),$("#point-canvas").attr("width",clientWidth+"px"),$("#point-canvas").attr("height",clientHeight+"px"),$("#point-canvas").css("width",clientWidth+"px"),$("#point-canvas").css("height",clientHeight+"px"),$("#map").attr("width",clientWidth+"px"),$("#map").attr("height",clientHeight+"px"),$("#map").css("width",clientWidth+"px"),$("#map").css("height",clientHeight+"px"),$(".music-switch").click(function(t){var i=$(this),a=$("#audio")[0];i.hasClass("music-play")?a.pause():a.play(),i.toggleClass("music-play")}),stopBackgroundCanvas||backCanvasStart(),pObj&&ap&&(ap.end(),$("#switch-text").css("opacity","0"),$("#switch-number").css("opacity","0"),setTimeout(function(){ap=startAnimation(pObj)},100))}function messageIn(){$(".message").css("opacity","1"),$(".main-title").css("opacity","1"),$(".main-locaiton").css("opacity","1"),$(".single-location").css("opacity","1"),$(".top-flow").css("opacity","1"),setTimeout(function(){canSwitch=!0},500)}function messageOut(){$(".message").css("opacity","0"),$(".main-title").css("opacity","0"),$(".main-locaiton").css("opacity","0"),$(".single-location").css("opacity","0"),$(".top-flow").css("opacity","0")}function preLoad(t,i){for(var a=t.length,e=0,s=e/a*100,n=0;n<t.length;n++){var o=new Image;o.onload=function(){s=++e/a*100,$("#loading-per").text(Math.floor(s)+"%"),a==e&&i()},o.src=t[n]}}function replay(){canReplay&&(canReplay=!1,$(".map-box").removeClass("map-box-1"),$(".map-box").removeClass("map-box-2"),$(".map-box").removeClass("map-box-3"),$(".map-box").removeClass("map-box-4"),$(".map-box").removeClass("map-box-5"),$(".map-box").removeClass("map-box-6"),$(".map-box").removeClass("map-box-7"),$(".map-box").removeClass("map-box-8"),$(".map-box").removeClass("map-box-9"),$(".map-box").removeClass("map-box-10"),loacl1=!0,loacl2=!0,loacl3=!0,loacl4=!0,loacl5=!0,switchFun=toSwitch1,$(".map-box").addClass("map-box-0-1"),setTimeout(function(){$(".thanks").css("opacity","0"),setTimeout(function(){$(".map-box").addClass("map-box-0-2"),setTimeout(function(){messageIn(),$(".thanks").css("display","none")},1e3)},1e3)},500))}function callSwitchFun(){canSwitch&&(canSwitch=!1,switchFun())}function endSwitch(){stopAnimation(),backCanvasStop(),setTimeout(moveFun,500)}function move1(){$(".map-box").addClass("map-box-2"),messageOut(),setTimeout(function(){$(".message").addClass("message-2"),$(".message").removeClass("message-1"),$(".single-location").html("&nbsp;&nbsp;体育东"),$(".main-locaiton").text(""),$(".year-range").text("2000年"),$(".message-content").html("互联网严冬<br>公司确立长期发展三大战略"),messageIn()},1500)}function move2(){$(".map-box").addClass("map-box-4"),messageOut(),setTimeout(function(){$(".message").addClass("message-3"),$(".message").removeClass("message-2"),$(".single-location").html("&nbsp;&nbsp;华天"),$(".main-locaiton").text(""),$(".year-range").text("2006年"),$(".message-content").html("入驻华天总部<br>开启公司高速发展新阶段"),messageIn()},1500)}function move3(){$(".map-box").addClass("map-box-6"),messageOut(),setTimeout(function(){$(".message").addClass("message-4"),$(".message").removeClass("message-3"),$(".single-location").html("&nbsp;&nbsp;越秀南"),$(".main-locaiton").text(""),$(".year-range").text("2013年"),$(".message-content").html("综合平台成立<br>全面拥抱移动互联网<br>入驻移互中心"),messageIn()},1500)}function move4(){$(".map-box").addClass("map-box-8"),messageOut(),setTimeout(function(){$(".message").addClass("message-5"),$(".message").removeClass("message-4"),$(".single-location").html("&nbsp;&nbsp;财润"),$(".main-locaiton").text(""),$(".year-range").text("2015年"),$(".message-content").html("公司业务指数级增长<br>扩容财润办公地点"),messageIn()},1500)}function move5(){canReplay=!0,$(".map-box").addClass("map-box-10"),messageOut(),setTimeout(function(){$(".thanks").css("display","block"),setTimeout(function(){$(".thanks").css("opacity","1")},100),$(".message").addClass("message-1"),$(".message").removeClass("message-5"),$(".single-location").html("&nbsp;&nbsp;天河"),$(".main-locaiton").text(""),$(".year-range").text("1999年"),$(".message-content").html("三次乔迁<br>21CN成立 出生非凡")},3e3)}function mapMoveTo(t,i,a){var e=clientWidth/baseFontSize/2,s=clientHeight/baseFontSize/2,n=-(t-e>0?t-e:0),o=-(i-s>0?i-s:0);$(".map-box").css("transform","translateX("+n+"rem) translateY("+o+"rem) scale("+a+")"),$(".map-box").css("transform-origin",t+"rem "+i+"rem")}function backCanvasStart(t){function a(t){x3d=t[0],y3d=t[1],z3d=t[2];var i=c/(c+z3d)/4,a=x3d*i+p,e=y3d*i+g;x.fillStyle=m[Math.floor(4*Math.random())],x.beginPath(),x.arc(a,e,i,0,2*Math.PI),x.fill()}function a(t){x3d=t[0],y3d=t[1],z3d=t[2];var i=c/(c+z3d)/4,a=x3d*i+p,e=y3d*i+g;x.fillStyle=t[3],x.beginPath(),x.arc(a,e,i,0,2*Math.PI),x.fill()}function e(){if(stopBackgroundCanvas)x.clearRect(0,0,clientWidth,clientHeight);else{for(x.drawImage(u,0,0,750,1206,0,0,clientWidth,clientHeight),i=0;i<d;i++)point3d=f[i],z3d=point3d[2],z3d-=1,z3d<-c&&(z3d+=400),point3d[2]=z3d,a(point3d);b.drawImage(w,0,0),requestAnimationFrame(e)}}$("#background-canvas").css("display","block"),setTimeout(function(){$("#background-canvas").css("opacity","1")},100),stopBackgroundCanvas=!1;var s=(t=t||{window_width:clientWidth,window_height:clientHeight,window_background:"#00113F",star_count:"100",star_color:"#FBFFAF",star_depth:"100"})&&t.window_width?t.window_width:"500",n=t&&t.window_height?t.window_height:"400",o=(t&&t.window_background&&t.window_background,t&&t.star_count?t.star_count:"600"),m=["#d3db18","#b003f8","#265754","#3b3c23"],r=t&&t.star_depth?t.star_depth:"250",c=parseInt(r),h=parseInt(s),l=parseInt(n),p=h/2,g=l/2,d=o,u=new Image;u.width=clientWidth+"px",u.height=clientWidth+"px",u.src="./images/switch-background.png";var b=document.getElementById("background-canvas").getContext("2d"),w=document.createElement("canvas");w.width=h,w.height=l;var x=w.getContext("2d"),f=[];!function(){for(i=0;i<d;i++)point=[400*Math.random()-200,400*Math.random()-200,400*Math.random()-200,m[Math.floor(4*Math.random())]],f.push(point)}(),requestAnimationFrame(e)}function backCanvasStop(){$("#background-canvas").css("opacity","0"),setTimeout(function(){stopBackgroundCanvas=!0,$("#background-canvas").css("display","none")},1e3)}function Particale(t){this.warp=t.warp,this.ctx=this.warp.getContext("2d"),this.assets=t.assets,this.assetsObj=[],this.radius=t.radius,this.index=0,this.initz=300,this.dots=[],this.init(),ap=this}function startAnimation(t){$("#point-canvas").css("opacity","1"),setTimeout(function(){$("#point-canvas").css("display","block"),particale=new Particale({warp:document.getElementById("point-canvas"),assets:t,radius:2})},1e3)}function stopAnimation(){particale.stop()}function toSwitch1(){loacl1&&(backCanvasStart(),setTimeout(function(){$(".map-box").addClass("map-box-1"),$(".map-box").removeClass("map-box-0-1"),$(".map-box").removeClass("map-box-0-2")},1e3),startAnimation(pObj=[{type:1,url:"images/1_1.png",widthPer:1,radius:2,html:"21CN.com 门户网站开通<br>1999.02",num:"1/3"},{type:1,url:"images/1_2.png",widthPer:1,radius:2,html:"21CN推出国内首批个人邮箱<br>1999.04",num:"2/3"},{type:1,url:"images/1_3.png",widthPer:1,radius:2,html:"世纪龙公司正式成立<br>1999.12",num:"3/3"}]),moveFun=move1,switchFun=toSwitch2,loacl1=!1)}function toSwitch2(){loacl2&&(backCanvasStart(),setTimeout(function(){$(".map-box").addClass("map-box-3"),$(".map-box").removeClass("map-box-1"),$(".map-box").removeClass("map-box-2")},1e3),startAnimation(pObj=[{type:1,url:"images/2_1.png",widthPer:1,radius:2,html:"首推付费个人商务邮箱<br>2001.02",num:"1/3"},{type:1,url:"images/2_2.png",widthPer:.7,radius:2,html:"21CN门户网站<br>中国第四，华南第一<br>2003.08",num:"2/3"},{type:1,url:"images/2_3.png",widthPer:1,radius:2,html:"21CN企业邮箱，综合实力第一<br>2005.08",num:"3/3"}]),moveFun=move2,switchFun=toSwitch3,loacl2=!1)}function toSwitch3(){loacl3&&(backCanvasStart(),setTimeout(function(){$(".map-box").addClass("map-box-5"),$(".map-box").removeClass("map-box-3"),$(".map-box").removeClass("map-box-4")},1e3),startAnimation(pObj=[{type:1,url:"images/3_1.png",widthPer:1.2,radius:2,html:"承建中国电信各省份3G门户<br>2008.10",num:"1/6"},{type:1,url:"images/3_2.png",widthPer:.5,radius:2,html:"189邮箱上线<br>2008.12",num:"2/6"},{type:1,url:"images/3_3.png",widthPer:1,radius:2,html:"感恩十年·你我同行<br>公司十周年庆<br>2009.12",num:"3/6"},{type:1,url:"images/3_4.png",widthPer:1,radius:2,html:"VGO上线<br>2010.08",num:"4/6"},{type:1,url:"images/3_5.png",widthPer:1,radius:2,html:"189邮箱（微邮）App上线<br>2011.07",num:"5/6"},{type:1,url:"images/3_6.png",widthPer:1,radius:2,html:"云存储业务“天翼云”上线<br>2012.07",num:"6/6"}]),moveFun=move3,switchFun=toSwitch4,loacl3=!1)}function toSwitch4(){loacl4&&(backCanvasStart(),setTimeout(function(){$(".map-box").addClass("map-box-7"),$(".map-box").removeClass("map-box-5"),$(".map-box").removeClass("map-box-6")},1e3),startAnimation(pObj=[{type:1,url:"images/4_1.png",widthPer:1.2,radius:2,html:"中国电信综合平台成立<br>2013.08",num:"1/3"},{type:1,url:"images/4_2.png",widthPer:1,radius:2,html:"流量宝3.0发布，推出流量红包<br>2014.11",num:"2/3"},{type:1,url:"images/4_3.png",widthPer:1,radius:2,html:"天翼流量800 合作伙伴大会召开<br>2014.12",num:"3/3"}]),moveFun=move4,switchFun=toSwitch5,loacl4=!1)}function toSwitch5(){loacl5&&(backCanvasStart(),setTimeout(function(){$(".map-box").addClass("map-box-9"),$(".map-box").removeClass("map-box-7"),$(".map-box").removeClass("map-box-8")},1e3),startAnimation(pObj=[{type:1,url:"images/5_1.png",widthPer:.5,radius:2,html:"微企上线<br>2015.01",num:"1/8"},{type:1,url:"images/5_2.png",widthPer:1,radius:2,html:"看荐上线<br>2015.07",num:"2/8"},{type:1,url:"images/5_3.png",widthPer:.4,radius:2,html:"流量来了上线<br>2016.01.01",num:"3/8"},{type:1,url:"images/5_4.png",widthPer:.8,radius:2,html:"流量宝推出流量红包<br>引起业内轰动<br>2016.01",num:"4/8"},{type:1,url:"images/5_5.png",widthPer:.7,radius:2,html:"流量+ 开放合作大会在北京召开<br>2016.08",num:"5/8"},{type:1,url:"images/5_6.png",widthPer:1,radius:2,html:"家庭云 上线<br>2017.05",num:"6/8"},{type:1,url:"images/5_7.png",widthPer:1,radius:2,html:"共筑生态·通行未来<br>天翼账号开放合作大会<br>在北京召开<br>2017.09",num:"7/8"},{type:1,url:"images/5_8.png",widthPer:1,radius:2,html:"翼健康生态合作大会在广州召开<br>2017.11",num:"8/8"}]),moveFun=move5,loacl5=!1)}function onlyWeixin(){return/micromessenger/i.test(navigator.userAgent.toLowerCase())}var clientWidth,clientHeight,baseFontSize,particale,toNextLoactionFunction,moveFun,switchFun,sl,stopBackgroundCanvas=!0,loacl1=!0,loacl2=!0,loacl3=!0,loacl4=!0,loacl5=!0,baserule=.02,baseRange=.04,pObj=null,ap=null,canReplay=!1,canSwitch=!1;$(function(){var t=document.documentElement.clientHeight<document.documentElement.clientWidth?document.documentElement.clientWidth:document.documentElement.clientHeight,i=document.documentElement.clientHeight>document.documentElement.clientWidth?document.documentElement.clientWidth:document.documentElement.clientHeight;sl=t/i,window.addEventListener("resize",initPage,!1),initPage(),onlyWeixin()?(preLoad(["./images/map1.jpg","./images/map2.jpg","./images/map3.jpg","./images/map4.jpg","./images/map5.jpg","./images/switch-background.png","./images/1_1.png","./images/1_2.png","./images/1_3.png","./images/2_1.png","./images/2_2.png","./images/2_3.png","./images/3_1.png","./images/3_2.png","./images/3_3.png","./images/3_4.png","./images/3_5.png","./images/3_6.png","./images/4_1.png","./images/4_2.png","./images/4_3.png","./images/4_4.png","./images/5_1.png","./images/5_2.png","./images/5_3.png","./images/5_4.png","./images/5_5.png","./images/5_6.png","./images/5_7.png","./images/5_8.png","./images/hand.png","./images/letter_title.png","./images/main_letter.png","./images/replay_button.png","./images/replay_text.png","./images/thanks_bottom.png","./images/open_letter.png","./images/message.png","./images/top_flow.png"],function(){$(".map-box").addClass("map-box-ready"),$(".map-box").addClass("map-box-0-1"),$("#loading-per").text("开始穿越"),$(".loading_button").click(function(){$("#loading-per").text("穿越中..."),$(".loading").css("opacity","0"),setTimeout(function(){$(".loading").remove(),setTimeout(function(){$(".map-box").addClass("map-box-0-2"),setTimeout(function(){messageIn()},1600)},600)},1e3)}),switchFun=toSwitch1,$("#switch-point").click(callSwitchFun)}),$("#replay").click(replay)):($(".only-weixin").css("display","block"),$("#audio").remove())}),Particale.prototype={constructor:Particale,init:function(){var t=this,i=this.assets.map(function(i,a){return new Promise(function(e,s){if(1==i.type){var n=new Image;n.onload=function(){n.widthPer=i.widthPer,n.radius=i.radius,n.html=i.html,n.num=i.num,i.showOri&&(n.showOri=i.showOri),t.assetsObj[a]=n,e()},n.src=i.url}else t.assetsObj[a]=i,e()})});this.offlineCanvas=document.createElement("canvas"),this.offlineCanvas.width=this.warp.width,this.offlineCanvas.height=this.warp.height,this.offlineCtx=this.offlineCanvas.getContext("2d"),Promise.all(i).then(function(){t.run=!0,t.picLoop()})},picLoop:function(){this.index!==this.assetsObj.length?(this.dots=[],this.drawPic(),this.toParticle(),this.combineAnimate(),this.index++):endSwitch()},drawPic:function(){this.ctx.clearRect(0,0,this.warp.width,this.warp.height);var t=this.assetsObj[this.index];if(this.currentImg=t,t.text){var i=.9*this.warp.width/t.text.length;t.double&&(i*=2),this.ctx.font="normal bold "+i+"px/"+i+"px Noto",this.ctx.fillStyle="#f9fafa";var a=this.ctx.measureText(t.text).width;a>.9*this.warp.width&&(a=.9*this.warp.width);var e=a/t.text.length;this.ctx.fillText(t.text,this.warp.width/2-a/2,1.5*(this.warp.height/2-e/2),.9*this.warp.width)}else ImgScale=t.height/t.width,t.width=this.warp.width*t.widthPer,t.height=t.width*ImgScale,this.radius=t.radius,$("#switch-text").html(t.html),$("#switch-number").text(t.num),this.ctx.drawImage(t,this.warp.width/2-t.width/2,.25*this.warp.height,t.width,t.height)},toParticle:function(){for(var t=this.ctx.getImageData(0,0,this.warp.width,this.warp.height),i=t.data,a=0;a<t.width;a+=2*this.radius)for(var e=0;e<t.height;e+=2*this.radius){var s=4*(a+e*this.warp.width);if(0!==i[s+3]){var n={x:a,y:e,z:0,r:i[s],g:i[s+1],b:i[s+2],a:1,ix:Math.random()*this.warp.width,iy:Math.random()*this.warp.height,iz:Math.random()*this.initz*2-this.initz,ir:255,ig:255,ib:255,ia:0,tx:Math.random()*this.warp.width,ty:Math.random()*this.warp.height,tz:Math.random()*this.initz*2-this.initz,tr:255,tg:255,tb:255,ta:0};this.dots.push(n)}}},combineAnimate:function(){if(this.run){$("#switch-text").css("opacity","1"),$("#switch-number").css("opacity","1");var t=this,i=!1;this.offlineCtx.clearRect(0,0,this.offlineCanvas.width,this.offlineCanvas.height),this.dots.map(function(a){return Math.abs(a.ix-a.x)<.3&&Math.abs(a.iy-a.y)<.3&&Math.abs(a.iz-a.z)<.3?(a.ix=a.x,a.iy=a.y,a.iz=a.z,a.ir=a.r,a.ig=a.g,a.ib=a.b,a.ia=a.a,i=!0):(a.ix+=.14*(a.x-a.ix),a.iy+=.14*(a.y-a.iy),a.iz+=.14*(a.z-a.iz),a.ir+=.6*(a.r-a.ir),a.ig+=.6*(a.g-a.ig),a.ib+=.6*(a.b-a.ib),a.ia+=.2*(a.a-a.ia),i=!1),t.drowDot(a)}),this.ctx.clearRect(0,0,this.warp.width,this.warp.height),this.ctx.drawImage(this.offlineCanvas,0,0),i?(t.currentImg.showOri&&t.ctx.drawImage(t.currentImg,t.warp.width/2-t.currentImg.width/2,t.warp.height/2-t.currentImg.height/2,t.currentImg.width,t.currentImg.height),setTimeout(function(){return t.separateAnimate()},1500)):requestAnimationFrame(function(){return t.combineAnimate()})}},separateAnimate:function(){if(this.run){$("#switch-text").css("opacity","0"),$("#switch-number").css("opacity","0");var t=this,i=!1;this.offlineCtx.clearRect(0,0,this.offlineCanvas.width,this.offlineCanvas.height),this.dots.map(function(a){return Math.abs(a.ix-a.tx)<.3&&Math.abs(a.iy-a.ty)<.3&&Math.abs(a.iz-a.tz)<.3?(a.ix=a.tx,a.iy=a.ty,a.iz=a.tz,a.ir=a.tr,a.ig=a.tg,a.ib=a.tb,a.ia=a.ta,i=!0):(a.ix+=.21*(a.tx-a.ix),a.iy+=.21*(a.ty-a.iy),a.iz+=.21*(a.tz-a.iz),a.ir+=.06*(a.tr-a.ir),a.ig+=.06*(a.tg-a.ig),a.ib+=.06*(a.tb-a.ib),a.ia+=.13*(a.ta-a.ia),i=!1),t.drowDot(a)}),this.ctx.clearRect(0,0,this.warp.width,this.warp.height),this.ctx.drawImage(this.offlineCanvas,0,0),i?setTimeout(function(){return t.picLoop()},300):requestAnimationFrame(function(){return t.separateAnimate()})}},drowDot:function(t){var i=this.initz/(this.initz+t.iz);this.offlineCtx.save(),this.offlineCtx.beginPath(),this.offlineCtx.fillStyle="rgba("+Math.floor(t.ir)+", "+Math.floor(t.ig)+", "+Math.floor(t.ib)+", "+t.ia+")",this.offlineCtx.arc(this.warp.width/2+(t.ix-this.warp.width/2)*i,this.warp.height/2+(t.iy-this.warp.height/2)*i,this.radius*i,0,2*Math.PI),this.offlineCtx.fill(),this.offlineCtx.closePath(),this.offlineCtx.restore()},stop:function(){var t=this;this.run=!1,this.warp.style.opacity="0",ap=null,setTimeout(function(){t.warp.style.display="none",t.ctx.clearRect(0,0,t.warp.width,t.warp.height),t.ctx.clearRect(0,0,t.warp.width,t.warp.height)},1e3)},end:function(){this.run=!1}};